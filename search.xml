<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DOM滚动触底检测</title>
    <url>/2023/04/23/DOM%E6%BB%9A%E5%8A%A8%E8%A7%A6%E5%BA%95%E6%A3%80%E6%B5%8B/</url>
    <content><![CDATA[<p>这里用到了几个基本的css变量：</p>
<ul>
<li>clientHeight：可视区域的高度</li>
<li>scrollTop：可视区域距离父容器顶部的距离</li>
<li>scrollHeight：父容器内部总高度，包括被卷(scroll)的高度</li>
<li>clientWidth：可视区域的宽度</li>
<li>scrollLeft：可视区域距离父容器左部的距离</li>
<li>scrollWidth：父容器内部总宽度，包括被卷(scroll)的宽度</li>
</ul>
<p>上代码~</p>
<span id="more"></span>

<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">280px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow-y</span>: scroll;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#inner</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">1000px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper2</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">280px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow-x</span>: scroll;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#inner2</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">1000px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>触底触顶检测<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;inner&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>触左触右检测<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;inner2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> $wrapper = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;wrapper&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        $wrapper.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, (<span class="function">(<span class="params">&#123;target&#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> touchBottom = target.<span class="property">clientHeight</span> + target.<span class="property">scrollTop</span> === target.<span class="property">scrollHeight</span>,</span></span><br><span class="line"><span class="language-javascript">                touchTop = target.<span class="property">scrollTop</span> === <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`touchBottom: <span class="subst">$&#123;touchBottom&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`touchTop: <span class="subst">$&#123;touchTop&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(touchBottom) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&#x27;滚动触底了！&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(touchTop) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&#x27;滚动触顶了！&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> $wrapper2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;wrapper2&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        $wrapper2.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, (<span class="function">(<span class="params">&#123;target&#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> touchRight = target.<span class="property">clientWidth</span> + target.<span class="property">scrollLeft</span> === target.<span class="property">scrollWidth</span>,</span></span><br><span class="line"><span class="language-javascript">                touchLeft = target.<span class="property">scrollLeft</span> === <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`touchRight: <span class="subst">$&#123;touchRight&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`touchLeft: <span class="subst">$&#123;touchLeft&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(touchRight) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&#x27;滚动触右了！&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(touchLeft) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&#x27;滚动触左了！&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;))</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>特效</tag>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>WOL网络唤醒</title>
    <url>/2023/05/09/WOL%E7%BD%91%E7%BB%9C%E5%94%A4%E9%86%92/</url>
    <content><![CDATA[<p>WOL(Wake On Lan)指的是通过网络唤醒电脑，配置流程如下：</p>
<span id="more"></span>

<p>只说一下关键步骤</p>
<ol>
<li>电脑BIOS需要开启对应的WOL选项</li>
<li>windows系统点击我的电脑-&gt;管理-&gt;网卡-&gt;允许魔术封包唤醒</li>
<li>windows电源选项关闭快速启动</li>
<li>windows防火墙允许端口7和9，并且协议为tcp&#x2F;udp</li>
<li>通过WOL客户端对电脑IP发送魔术封包即可开机</li>
</ol>
<p>目前几个问题：<br>电脑关机状态只有关机后的几分钟可以开机成功，过了那几分钟就不能开机成功，但是睡眠状态下随时可以开机成功</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>WOL</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo配置about、categories和tags</title>
    <url>/2023/02/03/hexo%E9%85%8D%E7%BD%AEabout%E3%80%81categories%E5%92%8Ctags/</url>
    <content><![CDATA[<p>本来照着官网把hexo博客给搭建好了，但是官网居然没有告诉应该怎么配置about、categories和tags。。。<br>没办法，只有自己去解决问题了~  </p>
<span id="more"></span>

<hr>
<h2 id="about"><a href="#about" class="headerlink" title="about"></a>about</h2><p>这个比较好处理</p>
<p>如果是全局安装的hexo，可以执行下面的命令</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page <span class="string">&quot;about&quot;</span></span><br></pre></td></tr></table></figure></div>
<p>如果是局部安装的，可以像这样写</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">npx hexo new page <span class="string">&quot;about&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>然后就会自动生成 source&#x2F;about&#x2F;index.md 文件，后面就可以像编辑博客一样编辑它了~</p>
<hr>
<h2 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h2><p>这个目录的创建和about一致，向下面这样写就行</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page <span class="string">&quot;categories&quot;</span></span><br></pre></td></tr></table></figure></div>
<p>或</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">npx hexo new page <span class="string">&quot;categories&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>然后才是重要的，想要使用categories的功能，需要修改自动生成的 &#x2F;source&#x2F;categories&#x2F;index.md 文件，将其内容修改为下面内容</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: categories</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line"><span class="section">layout: &quot;categories&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure></div>

<p>然后新建一个博客文件</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">&#x27;测试categories&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>将该博客文件的初始内容改为</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 测试categories</span><br><span class="line">categories:</span><br><span class="line"><span class="section">- 分类1</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure></div>

<p>这样新建的博客就会自动被分类到 “分类1” 中去了~</p>
<p>如果想要给一篇博客多个分类可以这样写</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 测试categories</span><br><span class="line">categories:</span><br><span class="line"><span class="bullet">-</span> [分类1]</span><br><span class="line"><span class="bullet">-</span> [分类2]</span><br><span class="line"><span class="section">- [分类3]</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure></div>

<p><em>千万不要忘了中括号，没有中括号会变成 分类1的子分类2的子分类3</em></p>
<hr>
<h2 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h2><p>这个目录的创建以及功能的实现和categories一致，只要改个名字就好了~</p>
<p>第一步创建目录</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page <span class="string">&quot;tags&quot;</span></span><br></pre></td></tr></table></figure></div>
<p>或</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">npx hexo new page <span class="string">&quot;tags&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>第二步修改文件<br>修改 &#x2F;source&#x2F;tags&#x2F;index.md 文件，使用下面的内容覆盖原本内容</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line"><span class="section">layout: &quot;tags&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure></div>

<p>第三步创建博客</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">&#x27;测试tags&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>第四步修改博客初始内容，使用下面内容覆盖它</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 测试tags</span><br><span class="line">tags:</span><br><span class="line"><span class="bullet">-</span> 标签1</span><br><span class="line"><span class="section">- 标签2</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure></div>

<p>这样就可以给博客添加 “标签1” 和 “标签2” 了，tags功能不用考虑中括号[].</p>
<hr>
<p>其实官网有说关于<a class="link"   href="https://hexo.io/zh-cn/docs/commands#new" >目录处理 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>的问题，但是说的很不清晰</p>
<blockquote>
<p>默认情况下，Hexo 会使用文章的标题来决定文章文件的路径。对于独立页面来说，Hexo 会创建一个以标题为名字的目录，并在目录中放置一个 index.md 文件。</p>
</blockquote>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>搭建博客</tag>
      </tags>
  </entry>
  <entry>
    <title>css父元素选择器</title>
    <url>/2023/05/18/css%E7%88%B6%E5%85%83%E7%B4%A0%E9%80%89%E6%8B%A9%E5%99%A8/</url>
    <content><![CDATA[<p>今天发现一个css父选择器写法</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.wrapper</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">2px</span> solid green;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.inner</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">2px</span> solid blue;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.heart</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">2px</span> solid red;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 父选择器，选择了.inner元素的父元素.wrapper */</span></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.wrapper</span><span class="selector-pseudo">:has</span>(<span class="selector-class">.inner</span>) &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border-top-left-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* 链式调用，实现祖先选择器 */</span></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.wrapper</span><span class="selector-pseudo">:has</span>(<span class="selector-class">.inner</span>)<span class="selector-pseudo">:has</span>(<span class="selector-class">.heart</span>) &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border-bottom-right-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;heart&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu安装我的世界服务器端</title>
    <url>/2023/04/22/Ubuntu%E5%AE%89%E8%A3%85%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<h1 id="1-安装java"><a href="#1-安装java" class="headerlink" title="1. 安装java"></a>1. 安装java</h1><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt install default-jdk</span><br></pre></td></tr></table></figure></div>

<span id="more"></span>

<h1 id="2-创建minecraft用户"><a href="#2-创建minecraft用户" class="headerlink" title="2. 创建minecraft用户"></a>2. 创建minecraft用户</h1><p><strong>因为安全原因， Minecraft 不应该在 root 用户下运行。我们将会创建一个新的系统用户和用户组，用户主目录&#x2F;opt&#x2F;minecraft。这个用户有最小权限，来运行 Minecraft 服务器端</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo useradd -r -m -U -d /opt/minecraft -s /bin/bash minecraft</span><br><span class="line">sudo su - minecraft</span><br><span class="line"><span class="built_in">mkdir</span> -p ~/&#123;backups,tools,server&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="3-Minecraft服务端"><a href="#3-Minecraft服务端" class="headerlink" title="3. Minecraft服务端"></a>3. Minecraft服务端</h1><h2 id="3-1-下载服务端"><a href="#3-1-下载服务端" class="headerlink" title="3.1. 下载服务端"></a>3.1. 下载服务端</h2><p><strong>wget下载的是1.16版本，如果需要最新版，可以去<a class="link"   href="https://www.minecraft.net/en-us/download/server" >官网下载最新版本 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，然后通过FTP传到&#x2F;opt&#x2F;minecraft&#x2F;server目录下</strong><br>java11可以兼容Minecraft1.16</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://launcher.mojang.com/v1/objects/a0d03225615ba897619220e256a266cb33a44b6b/server.jar -P ~/server</span><br></pre></td></tr></table></figure></div>

<h2 id="3-2-配置服务端"><a href="#3-2-配置服务端" class="headerlink" title="3.2. 配置服务端"></a>3.2. 配置服务端</h2><p>第一次启动服务端会创建server.properties和eula.txt文件，然后停止运行</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/server</span><br><span class="line">java -Xmx1024M -Xms1024M -jar server.jar nogui</span><br></pre></td></tr></table></figure></div>
<p>修改eula.txt<br><em>eula&#x3D;true</em> ，<br>类似于需要同意一份协议才能正常运行服务端</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/server</span><br><span class="line">vim eula.txt</span><br></pre></td></tr></table></figure></div>
<p>配置好eula后，进入server.properties配置服务器端信息</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/server</span><br><span class="line">vim server.properties</span><br></pre></td></tr></table></figure></div>

<p><strong>修改server.properties</strong><br><em><strong>online-mode&#x3D;false</strong></em><br><strong>这直接关系到开服后能否进入游戏，否则会出现无效会话的问题</strong></p>
<h2 id="3-3-配置防火墙"><a href="#3-3-配置防火墙" class="headerlink" title="3.3. 配置防火墙"></a>3.3. 配置防火墙</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ufw allow 25565/tcp</span><br></pre></td></tr></table></figure></div>

<h1 id="4-其他"><a href="#4-其他" class="headerlink" title="4. 其他"></a>4. 其他</h1><h2 id="4-1-将服务端添加到系统服务并自启动"><a href="#4-1-将服务端添加到系统服务并自启动" class="headerlink" title="4.1. 将服务端添加到系统服务并自启动"></a>4.1. 将服务端添加到系统服务并自启动</h2><p>创建&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;minecraft.service文件</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/systemd/system/minecraft.service</span><br></pre></td></tr></table></figure></div>
<p>修改文件内容为</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Minecraft Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=minecraft</span><br><span class="line">Nice=1</span><br><span class="line">KillMode=none</span><br><span class="line">SuccessExitStatus=0 1</span><br><span class="line">ProtectHome=true</span><br><span class="line">ProtectSystem=full</span><br><span class="line">PrivateDevices=true</span><br><span class="line">NoNewPrivileges=true</span><br><span class="line">WorkingDirectory=/opt/minecraft/server</span><br><span class="line">ExecStart=/usr/bin/java -Xmx1024M -Xms1024M -jar server.jar nogui</span><br><span class="line">ExecStop=/opt/minecraft/tools/mcrcon/mcrcon -H 127.0.0.1 -P 25575 -p PASSWORD stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></div>
<p>绑定系统服务并自启动</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start minecraft</span><br><span class="line">sudo systemctl status minecraft</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> minecraft</span><br></pre></td></tr></table></figure></div>

<h2 id="4-2-mcrcon"><a href="#4-2-mcrcon" class="headerlink" title="4.2. mcrcon"></a>4.2. mcrcon</h2><p>mcrcon是一个rcon客户端，用来控制minecraft服务端</p>
<p>下载并编译</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Tiiffi/mcrcon.git ~/tools/mcrcon</span><br><span class="line"><span class="built_in">cd</span> ~/tools/mcrcon</span><br><span class="line">make</span><br><span class="line">./mcrcon -v</span><br></pre></td></tr></table></figure></div>

<p>修改server.properties<br>enable-rcon&#x3D;true<br>rcon.port&#x3D;25575<br>rcon.password&#x3D;PASSWORD  </p>
<p>通过mcrcon访问服务端</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">/opt/minecraft/tools/mcrcon/mcrcon -H 127.0.0.1 -P 25575 -p PASSWORD -t</span><br></pre></td></tr></table></figure></div>

<h2 id="4-3-定时备份"><a href="#4-3-定时备份" class="headerlink" title="4.3. 定时备份"></a>4.3. 定时备份</h2><p>创建自动备份程序文件 &#x2F;opt&#x2F;minecraft&#x2F;tools&#x2F;backup.sh ，并给其可执行权限</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /opt/minecraft/tools/backup.sh</span><br><span class="line">sudo <span class="built_in">chmod</span> 770 /opt/minecraft/tools/backup.sh</span><br></pre></td></tr></table></figure></div>
<p>内容为</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> rcon &#123;</span><br><span class="line">  /opt/minecraft/tools/mcrcon/mcrcon -H 127.0.0.1 -P 25575 -p strong-password <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rcon <span class="string">&quot;save-off&quot;</span></span><br><span class="line">rcon <span class="string">&quot;save-all&quot;</span></span><br><span class="line">tar -cvpzf /opt/minecraft/backups/server-$(<span class="built_in">date</span> +%F-%H-%M).tar.gz /opt/minecraft/server</span><br><span class="line">rcon <span class="string">&quot;save-on&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Delete older backups</span></span><br><span class="line">find /opt/minecraft/backups/ -<span class="built_in">type</span> f -mtime +7 -name <span class="string">&#x27;*.gz&#x27;</span> -delete</span><br></pre></td></tr></table></figure></div>
<p>给当前用户添加定时任务</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure></div>
<p>在定时任务文件中添加以下内容，每天23点定时运行</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">0 23 * * * /opt/minecraft/tools/backup.sh</span><br></pre></td></tr></table></figure></div>

<h2 id="4-4-server-properties配置参考"><a href="#4-4-server-properties配置参考" class="headerlink" title="4.4. server.properties配置参考"></a>4.4. server.properties配置参考</h2><p><a class="link"   href="https://minecraft.fandom.com/zh/wiki/Server.properties?variant=zh" >我的世界百科 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">spawn-protection=16</span><br><span class="line"></span><br><span class="line"><span class="comment">#出生点保护半径(若没有op则不生效)</span></span><br><span class="line"></span><br><span class="line">max-tick-time=60000</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置每个tick花费的最大毫秒数</span></span><br><span class="line"></span><br><span class="line">query.port=25565</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置监听服务器的端口号</span></span><br><span class="line"></span><br><span class="line">generator-settings=</span><br><span class="line"></span><br><span class="line"><span class="comment">#用于自定义超平坦世界的生成</span></span><br><span class="line"></span><br><span class="line">force-gamemode=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#玩家加入服务器时强制变成默认游戏模式</span></span><br><span class="line"></span><br><span class="line">allow-nether=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否开启地狱世界(关闭后删除将不会生成地狱世界)</span></span><br><span class="line"></span><br><span class="line">enforce-whitelist=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在服务器上强制执行白名单。</span></span><br><span class="line"></span><br><span class="line">gamemode=survival</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置玩家的游戏模式</span></span><br><span class="line"></span><br><span class="line">broadcast-console-to-ops=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*给op发送控制台信息?</span></span><br><span class="line"></span><br><span class="line">enable-query=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否开启GameSpy4协议服务器监听器，用于获取服务器信息，建议不要修改</span></span><br><span class="line"></span><br><span class="line">player-idle-timeout=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#当进入AFK模式,在规定时间内T出服务器,设置成0为不T出服务器</span></span><br><span class="line"></span><br><span class="line">difficulty=easy</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置游戏的难度（peaceful(0)=和平，easy(1)=简单，normal(2)=普通，hard(3)=困难）</span></span><br><span class="line"></span><br><span class="line">broadcast-rcon-to-ops=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*允许远程连接控制台给op发送信息?</span></span><br><span class="line"></span><br><span class="line">spawn-monsters=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否生成怪物</span></span><br><span class="line"></span><br><span class="line">op-permission-level=4</span><br><span class="line"></span><br><span class="line"><span class="comment">#设定OP的权限等级</span></span><br><span class="line"></span><br><span class="line">pvp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否可以打架</span></span><br><span class="line"></span><br><span class="line">snooper-enabled=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用后，服务端将会定期发送统计数据到http://snoop.minecraft.net</span></span><br><span class="line"></span><br><span class="line">level-type=default</span><br><span class="line"></span><br><span class="line"><span class="comment">#确定地图所生成的类型 </span></span><br><span class="line"></span><br><span class="line">hardcore=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#极限模式（一旦启用，玩家死后会被服务器封禁）</span></span><br><span class="line"></span><br><span class="line">enable-command-block=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否启用命令方块</span></span><br><span class="line"></span><br><span class="line">max-players=20</span><br><span class="line"></span><br><span class="line"><span class="comment">#最大玩家数</span></span><br><span class="line"></span><br><span class="line">max-world-size=29999984</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置世界边界的最大半径值，以方块作为单位</span></span><br><span class="line"></span><br><span class="line">resource-pack-sha1=</span><br><span class="line"></span><br><span class="line"><span class="comment">#资源包的SHA-1值，必须为小写十六进制</span></span><br><span class="line"></span><br><span class="line">function-permission-level=2</span><br><span class="line"></span><br><span class="line"><span class="comment">#用于控制函数拥有的权限等级。</span></span><br><span class="line"></span><br><span class="line">rcon.port=25575</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置远程端口号</span></span><br><span class="line"></span><br><span class="line">server-port=25565</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置服务器本地端口号</span></span><br><span class="line"></span><br><span class="line">server-ip=</span><br><span class="line"></span><br><span class="line"><span class="comment">#将服务器与一个特定IP绑定。建议留空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#留空，或是填入你想让服务器绑定的域名。</span></span><br><span class="line"></span><br><span class="line">spawn-npcs=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#是否生成村民</span></span><br><span class="line"></span><br><span class="line">allow-flight=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#允许或不允许玩家在生存模式下飞行</span></span><br><span class="line"></span><br><span class="line">level-name=world</span><br><span class="line"></span><br><span class="line"><span class="comment">#主世界的名称</span></span><br><span class="line"></span><br><span class="line">view-distance=10</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置服务端传送给客户端的区块量</span></span><br><span class="line"></span><br><span class="line">resource-pack=</span><br><span class="line"></span><br><span class="line"><span class="comment">#可输入指向一个资源包的URI</span></span><br><span class="line"></span><br><span class="line">spawn-animals=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成或不生成动物</span></span><br><span class="line"></span><br><span class="line">white-list=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#白名单</span></span><br><span class="line"></span><br><span class="line">rcon.password=</span><br><span class="line"></span><br><span class="line"><span class="comment">#远程访问密码</span></span><br><span class="line"></span><br><span class="line">generate-structures=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义是否在生成世界时生成结构</span></span><br><span class="line"></span><br><span class="line">online-mode=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#正版验证是否开启（将true改为false后离线 外置 正版都可以进入）</span></span><br><span class="line"></span><br><span class="line">max-build-height=256</span><br><span class="line"></span><br><span class="line"><span class="comment">#玩家在游戏中能够建造的最大高度</span></span><br><span class="line"></span><br><span class="line">level-seed=</span><br><span class="line"></span><br><span class="line"><span class="comment">#世界种子</span></span><br><span class="line"></span><br><span class="line">motd=A Minecraft Server</span><br><span class="line"></span><br><span class="line"><span class="comment">#玩家客户端的多人游戏服务器列表中显示的服务器信息，显示于名称下方</span></span><br></pre></td></tr></table></figure></div>

<h1 id="5-我的世界Mod版本"><a href="#5-我的世界Mod版本" class="headerlink" title="5. 我的世界Mod版本"></a>5. 我的世界Mod版本</h1><h2 id="5-1-服务器下载"><a href="#5-1-服务器下载" class="headerlink" title="5.1. 服务器下载"></a>5.1. <a class="link"   href="https://files.minecraftforge.net/net/minecraftforge/forge/" >服务器下载 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h2><p>这里下载的是forge版本的Minecraft<br><em>注意，如果自动下载失败，可能需要vpn</em></p>
<h2 id="5-2-服务器安装"><a href="#5-2-服务器安装" class="headerlink" title="5.2. 服务器安装"></a>5.2. 服务器安装</h2><p>需要先在windows上执行下载的jar文件，执行后会出现GUI界面，选择安装server版本，并且选择一个新的文件夹当作服务器目录，<br>安装完成后，服务器目录会出现一些文件，把这些文件复制到Ubuntu上，<br>然后执行run.sh文件，后面就跟安装普通服务器一样了，需要同意eula，然后修改server.properties，最后再次执行run.sh就行了</p>
<h2 id="5-3-安装Mod"><a href="#5-3-安装Mod" class="headerlink" title="5.3. 安装Mod"></a>5.3. 安装Mod</h2><p>可以去<a class="link"   href="https://www.curseforge.com/minecraft/search?page=1&pageSize=20&sortType=1" >Minecraft Mod网站 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>下载Mod，<br>然后将Mod（一般是.jar文件）放到游戏目录的mods目录下就可以用了，<br>客户端和服务器都需要将Mod放到mods文件夹里面，否则不能正常运行。</p>
<h2 id="5-4-将服务端添加到系统服务并自启动"><a href="#5-4-将服务端添加到系统服务并自启动" class="headerlink" title="5.4. 将服务端添加到系统服务并自启动"></a>5.4. 将服务端添加到系统服务并自启动</h2><p><strong>注意，这里设置和普通服务器有一些不一样，不同之处就是需要root用户来执行，不能用minecraft用户执行，猜测可能是Mod版本需要root的权限比较多</strong><br>创建&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;minecraft.service文件</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/systemd/system/minecraft.service</span><br></pre></td></tr></table></figure></div>
<p>修改文件内容为，User必须是root</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Minecraft Server</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">WorkingDirectory=/opt/minecraft_forge/server</span><br><span class="line">ExecStart=/usr/bin/bash run.sh</span><br><span class="line">ExecStop=/opt/minecraft/tools/mcrcon/mcrcon -H 127.0.0.1 -P 25575 -p PASSWORD stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></div>
<p>绑定系统服务并自启动</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start minecraft <span class="comment"># 手动启动服务器最好切换到root用户</span></span><br><span class="line">sudo systemctl status minecraft</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> minecraft <span class="comment"># 设置自启动最好也切换到root用户</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Minecraft</tag>
      </tags>
  </entry>
  <entry>
    <title>javasSript小数相加精度问题</title>
    <url>/2023/02/24/javasSript%E5%B0%8F%E6%95%B0%E7%9B%B8%E5%8A%A0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>如果在javasSript中0.1 + 0.3会出现精度问题，那么其他小数相加会不会也有问题呢？<br>测试用代码和结果如下</p>
<span id="more"></span>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">.1</span>, <span class="number">.2</span>, <span class="number">.3</span>, <span class="number">.4</span>, <span class="number">.5</span>, <span class="number">.6</span>, <span class="number">.7</span>, <span class="number">.8</span>, <span class="number">.9</span>]</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; arr.<span class="property">length</span>;i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> val1 = arr[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = i;j &lt; arr.<span class="property">length</span>;j++) &#123;</span><br><span class="line">        <span class="keyword">let</span> val2 = arr[j];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;val1&#125;</span> + <span class="subst">$&#123;val2&#125;</span> = <span class="subst">$&#123;val1 + val2&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 0.1 + 0.1 = 0.2</span></span><br><span class="line"><span class="comment">// 0.1 + 0.2 = 0.30000000000000004</span></span><br><span class="line"><span class="comment">// 0.1 + 0.3 = 0.4</span></span><br><span class="line"><span class="comment">// 0.1 + 0.4 = 0.5</span></span><br><span class="line"><span class="comment">// 0.1 + 0.5 = 0.6</span></span><br><span class="line"><span class="comment">// 0.1 + 0.6 = 0.7</span></span><br><span class="line"><span class="comment">// 0.1 + 0.7 = 0.7999999999999999</span></span><br><span class="line"><span class="comment">// 0.1 + 0.8 = 0.9</span></span><br><span class="line"><span class="comment">// 0.1 + 0.9 = 1</span></span><br><span class="line"><span class="comment">// 0.2 + 0.2 = 0.4</span></span><br><span class="line"><span class="comment">// 0.2 + 0.3 = 0.5</span></span><br><span class="line"><span class="comment">// 0.2 + 0.4 = 0.6000000000000001</span></span><br><span class="line"><span class="comment">// 0.2 + 0.5 = 0.7</span></span><br><span class="line"><span class="comment">// 0.2 + 0.6 = 0.8</span></span><br><span class="line"><span class="comment">// 0.2 + 0.7 = 0.8999999999999999</span></span><br><span class="line"><span class="comment">// 0.2 + 0.8 = 1</span></span><br><span class="line"><span class="comment">// 0.2 + 0.9 = 1.1</span></span><br><span class="line"><span class="comment">// 0.3 + 0.3 = 0.6</span></span><br><span class="line"><span class="comment">// 0.3 + 0.4 = 0.7</span></span><br><span class="line"><span class="comment">// 0.3 + 0.5 = 0.8</span></span><br><span class="line"><span class="comment">// 0.3 + 0.6 = 0.8999999999999999</span></span><br><span class="line"><span class="comment">// 0.3 + 0.7 = 1</span></span><br><span class="line"><span class="comment">// 0.3 + 0.8 = 1.1</span></span><br><span class="line"><span class="comment">// 0.3 + 0.9 = 1.2</span></span><br><span class="line"><span class="comment">// 0.4 + 0.4 = 0.8</span></span><br><span class="line"><span class="comment">// 0.4 + 0.5 = 0.9</span></span><br><span class="line"><span class="comment">// 0.4 + 0.6 = 1</span></span><br><span class="line"><span class="comment">// 0.4 + 0.7 = 1.1</span></span><br><span class="line"><span class="comment">// 0.4 + 0.8 = 1.2000000000000002</span></span><br><span class="line"><span class="comment">// 0.4 + 0.9 = 1.3</span></span><br><span class="line"><span class="comment">// 0.5 + 0.5 = 1</span></span><br><span class="line"><span class="comment">// 0.5 + 0.6 = 1.1</span></span><br><span class="line"><span class="comment">// 0.5 + 0.7 = 1.2</span></span><br><span class="line"><span class="comment">// 0.5 + 0.8 = 1.3</span></span><br><span class="line"><span class="comment">// 0.5 + 0.9 = 1.4</span></span><br><span class="line"><span class="comment">// 0.6 + 0.6 = 1.2</span></span><br><span class="line"><span class="comment">// 0.6 + 0.7 = 1.2999999999999998</span></span><br><span class="line"><span class="comment">// 0.6 + 0.8 = 1.4</span></span><br><span class="line"><span class="comment">// 0.6 + 0.9 = 1.5</span></span><br><span class="line"><span class="comment">// 0.7 + 0.7 = 1.4</span></span><br><span class="line"><span class="comment">// 0.7 + 0.8 = 1.5</span></span><br><span class="line"><span class="comment">// 0.7 + 0.9 = 1.6</span></span><br><span class="line"><span class="comment">// 0.8 + 0.8 = 1.6</span></span><br><span class="line"><span class="comment">// 0.8 + 0.9 = 1.7000000000000002</span></span><br><span class="line"><span class="comment">// 0.9 + 0.9 = 1.8</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu命令记录</title>
    <url>/2023/04/22/Ubuntu%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>持续补充中…</p>
<h1 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h1><p>连接远程服务器</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">ssh USER@ip</span><br></pre></td></tr></table></figure></div>

<span id="more"></span>

<h1 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h1><h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Ubuntu版本</span></span><br><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">查看Linux内核版本</span><br><span class="line"><span class="built_in">cat</span> /proc/version</span><br></pre></td></tr></table></figure></div>

<h2 id="关机定时启动系统"><a href="#关机定时启动系统" class="headerlink" title="关机定时启动系统"></a>关机定时启动系统</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 立刻关机，并且在1800秒之后重启</span></span><br><span class="line">sudo rtcwake -m off -s 1800</span><br></pre></td></tr></table></figure></div>

<h2 id="日期时间"><a href="#日期时间" class="headerlink" title="日期时间"></a>日期时间</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前时间</span></span><br><span class="line"><span class="built_in">date</span> -R</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 调整时区为中国上海</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br><span class="line"><span class="comment"># 将当前时间写入BIOS避免重启失效</span></span><br><span class="line">sudo hwclock --systohc</span><br></pre></td></tr></table></figure></div>

<h2 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看已安装软件</span></span><br><span class="line">sudo dpkg --list | grep -i PACKAGE</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 卸载软件</span></span><br><span class="line">sudo apt-get remove PACKAGE</span><br><span class="line"><span class="comment"># 完全删除软件</span></span><br><span class="line">sudo apt-get purge PACKAGE</span><br><span class="line"><span class="comment"># 自动清理不需要的依赖</span></span><br><span class="line">sudo apt-get autoremove</span><br></pre></td></tr></table></figure></div>

<h2 id="查看硬件设备"><a href="#查看硬件设备" class="headerlink" title="查看硬件设备"></a>查看硬件设备</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看pcie设备</span></span><br><span class="line">lspci</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看usb设备</span></span><br><span class="line">lsusb</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install lm-sensors</span><br><span class="line"><span class="comment"># 查看CPU、GPU温度</span></span><br><span class="line">sensors</span><br><span class="line"><span class="comment"># 查看实时温度</span></span><br><span class="line">watch sensors</span><br></pre></td></tr></table></figure></div>

<h2 id="搜索和过滤"><a href="#搜索和过滤" class="headerlink" title="搜索和过滤"></a>搜索和过滤</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 过滤命令返回的结果，-i表示不区分大小写</span></span><br><span class="line">COMMAND | grep -i KEYWORD</span><br><span class="line"><span class="comment"># findstr是windows的命令，功能和grep差不多</span></span><br></pre></td></tr></table></figure></div>

<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看指定端口有没有开启</span></span><br><span class="line"><span class="comment"># 切换到root用户才可以看到所有信息，否则只能看到当前用户的信息</span></span><br><span class="line">sudo -i</span><br><span class="line">netstat -ap | grep PORT</span><br></pre></td></tr></table></figure></div>

<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> PID</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br></pre></td></tr></table></figure></div>

<h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">sudo useradd USER</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">sudo deluser --remove-home USER</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 切换普通用户</span></span><br><span class="line">sudu su - USER</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 切换根用户</span></span><br><span class="line">sudu -i</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看用户列表</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看用户组列表</span></span><br><span class="line"><span class="built_in">cat</span> /etc/group</span><br></pre></td></tr></table></figure></div>

<h2 id="文件系统权限"><a href="#文件系统权限" class="headerlink" title="文件系统权限"></a>文件系统权限</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改目录所属用户</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R USER[:GROUP] FOLDER</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改目录权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> -R 777 FOLDER</span><br></pre></td></tr></table></figure></div>

<h2 id="文件及目录增删改查"><a href="#文件及目录增删改查" class="headerlink" title="文件及目录增删改查"></a>文件及目录增删改查</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除非空文件夹</span></span><br><span class="line"><span class="built_in">rm</span> -r FOLDER</span><br></pre></td></tr></table></figure></div>

<h2 id="服务-x2F-守护进程"><a href="#服务-x2F-守护进程" class="headerlink" title="服务&#x2F;守护进程"></a>服务&#x2F;守护进程</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>需要在&#x2F;etc&#x2F;systemd&#x2F;system目录下新建 DAEMON.service 文件来配置服务<br>内容基本如下</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Minecraft Server</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">WorkingDirectory=/opt/minecraft_forge/server</span><br><span class="line">ExecStart=/usr/bin/bash run.sh</span><br><span class="line">ExecStop=/opt/minecraft/tools/mcrcon/mcrcon -H 127.0.0.1 -P 25575 -p PASSWORD stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></div>
<p>这里重点说一下因为 <em>权限问题</em> 导致启动服务不成功的解决办法，<br>关键是 DAEMON.service 文件里面配置的 <em>User</em>字段 是否有足够的权限，<br>视情况可以改为 <em>root</em> 用户</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重载服务配置</span></span><br><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动指定服务</span></span><br><span class="line">sudo systemctl start DAEMON</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">sudo systemctl restart DAEMON</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭指定服务</span></span><br><span class="line">sudo systemctl stop DAEMON</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看指定服务状态</span></span><br><span class="line">sudo systemctl status DAEMON</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 服务自启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> DAEMON</span><br></pre></td></tr></table></figure></div>


<h1 id="分屏"><a href="#分屏" class="headerlink" title="分屏"></a>分屏</h1><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建新分屏</span></span><br><span class="line">screen -S SCREENNAME</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前用户下的所有分屏</span></span><br><span class="line">screen -<span class="built_in">ls</span></span><br></pre></td></tr></table></figure></div>


<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 退出当前分屏，停止运行</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入指定分屏</span></span><br><span class="line">screen -r PROCESSID</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>退出当前分屏，继续运行<br>ctrl + a 同时 ctrl + d</p>
</blockquote>
<h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 需要当前目录下有Makefile文件</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装编译后的软件</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 卸载编译后的软件，需要软件提供卸载功能</span></span><br><span class="line">make uninstall</span><br></pre></td></tr></table></figure></div>

<h1 id="常用命令行软件"><a href="#常用命令行软件" class="headerlink" title="常用命令行软件"></a>常用命令行软件</h1><h2 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h2><blockquote>
<p>搜索关键字<br>&#x2F;keyword</p>
</blockquote>
<blockquote>
<p>模糊搜索关键字,搜索到了之后按”n”键查看下一个匹配项，按”N”查看上一个匹配项<br>?keyword</p>
</blockquote>
<blockquote>
<p>不保存退出<br>:q!</p>
</blockquote>
<blockquote>
<p>查看文件编码<br>:set ff</p>
</blockquote>
<blockquote>
<p>修改文件编码<br>:set ff&#x3D;unix<br>:set ff&#x3D;dos<br>将文件编码修改为 unix 可以解决linux下sh文件不能执行的问题</p>
</blockquote>
<h2 id="nano"><a href="#nano" class="headerlink" title="nano"></a>nano</h2><blockquote>
<p>保存文件<br>ctrl + o</p>
</blockquote>
<blockquote>
<p>保存退出文件<br>ctrl + x</p>
</blockquote>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>使用PuTTY和ssh密钥登录Ubuntu</title>
    <url>/2023/04/22/%E4%BD%BF%E7%94%A8PuTTY%E5%92%8Cssh%E5%AF%86%E9%92%A5%E7%99%BB%E5%BD%95Ubuntu/</url>
    <content><![CDATA[<h1 id="1-服务端配置"><a href="#1-服务端配置" class="headerlink" title="1. 服务端配置"></a>1. 服务端配置</h1><h2 id="1-1-允许密钥登录"><a href="#1-1-允许密钥登录" class="headerlink" title="1.1 允许密钥登录"></a>1.1 允许密钥登录</h2><p>配置 &#x2F;etc&#x2F;ssh&#x2F;sshd_config</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></div>

<span id="more"></span>

<p>添加内容</p>
<div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="code"><pre><span class="line"># 启用RSA认证</span><br><span class="line">RSAAuthentication yes</span><br><span class="line"># 启用公钥认证</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"># 禁止root用户登录</span><br><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure></div>
<h2 id="1-2-生成密钥对"><a href="#1-2-生成密钥对" class="headerlink" title="1.2 生成密钥对"></a>1.2 生成密钥对</h2><p>-t: 密钥类型，可以选择 dsa | ecdsa | ed25519 | rsa; 省略的情况下默认是rsa</p>
<p>-f: 密钥目录位置，指定生成密钥的保存路径和文件名。省略的情况下， 默认为当前用户home路径下的.ssh隐藏目录，也就是<del>&#x2F;.ssh&#x2F;，同时默认密钥文件名以id_rsa开头。省略的情况下，默认目录就是</del>&#x2F;.ssh&#x2F;，不会再次提醒输入。但是会再次提是你输入文件名，如果不输入直接回车，则默认的密钥文件名就是id_rsa</p>
<p>-C: 指定此密钥的备注信息，需要配置多个免密登录时，建议携带;生成的公钥会在最后面显示此备注信息</p>
<p>-N: 指定此密钥对的密码，如果指定此参数，则命令执行过程中就不会出现交互确认密码的信息了。如果省略此参数，会提示你输入密码和密码确认。一般情况下不用输入，直接回车就行。如果输入密码之后，以后每次都要输入密码。这里请根据你的安全需要决定是否需要密码，如果不需要，直接回车。</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -f ~/.ssh/id_rsa -N shoufeng -C shoufeng</span><br></pre></td></tr></table></figure></div>
<p>生成成功后会在 ~&#x2F;.</p>
<h2 id="1-3-在服务器上安装公钥"><a href="#1-3-在服务器上安装公钥" class="headerlink" title="1.3. 在服务器上安装公钥"></a>1.3. 在服务器上安装公钥</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line"><span class="built_in">cat</span> id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure></div>
<p>保证只有自己的账户能够对ssh读写，只要确保后面两位都是0就行了</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br></pre></td></tr></table></figure></div>

<h2 id="1-4-重启ssh"><a href="#1-4-重启ssh" class="headerlink" title="1.4. 重启ssh"></a>1.4. 重启ssh</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure></div>

<h1 id="2-客户端配置"><a href="#2-客户端配置" class="headerlink" title="2. 客户端配置"></a>2. 客户端配置</h1><h2 id="2-1-PuTTY"><a href="#2-1-PuTTY" class="headerlink" title="2.1. PuTTY"></a>2.1. PuTTY</h2><h3 id="2-2-私钥格式转换"><a href="#2-2-私钥格式转换" class="headerlink" title="2.2. 私钥格式转换"></a>2.2. 私钥格式转换</h3><p>把生成的私钥文件 id.rsa 下载下来，然后通过PuTTygen转化为 ppk 格式。<br>一般安装了PuTTY都会附加安装PuTTYgen。<br>电脑搜索打开PuTTYgen，选择上方菜单栏 Conversions -&gt; Import key 导入下载的 id.rsa 文件，点击 Save private Key 按钮保存到本地。</p>
<h3 id="2-3-配置PuTTY"><a href="#2-3-配置PuTTY" class="headerlink" title="2.3. 配置PuTTY"></a>2.3. 配置PuTTY</h3><p>打开PuTTy。<br>找到 Connection -&gt; SSH -&gt; Auth ，在 Private key file for authentication 区域选择私钥ppk文件。<br>找到 Connection -&gt; Data ，在 Auto-login username 填入用户名<br>找到 Session ，输入服务器地址，然后 Save，最后再 Open 就可以了</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>PuTTY</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack基础使用</title>
    <url>/2023/04/27/webpack%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>这里记录下 webpack 的基本使用，因为每次我新建项目的时候都要去搜索一下 webpack，感觉很麻烦，所以还是自己记录下使用的方法，增强下记忆。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="webpack-安装"><a href="#webpack-安装" class="headerlink" title="webpack 安装"></a>webpack 安装</h2><p>写文章的时候，webpack 最新版本是 5.81.0，可以参考<a class="link"   href="https://www.webpackjs.com/guides/getting-started/#basic-setup" >官网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure></div>

<p>一般都是使用命令行来操作 webpack，所以顺便把 webpack-cli 给安装了</p>
<span id="more"></span>

<h2 id="其他常用插件安装"><a href="#其他常用插件安装" class="headerlink" title="其他常用插件安装"></a>其他常用插件安装</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">npm install babel-loader webpack-dev-server html-webpack-plugin clean-webpack-plugin copy-webpack-plugin -D</span><br></pre></td></tr></table></figure></div>

<p>这里分别装了：</p>
<ol>
<li>babel-loader<br>用来兼容 js 不同版本语法</li>
<li>webpack-dev-server<br>用来开启本地服务器（开发时使用）</li>
<li>html-webpack-plugin<br>用来设置不用打包的静态文件，比如 html 文件</li>
<li>clean-webpack-plugin<br>每次打包之前都会清空打包目录</li>
<li>copy-webpack-plugin<br>用来复制静态文件到指定的打包目录</li>
</ol>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>在项目根目录下新建配置文件：</p>
<ol>
<li>webpack.config.js（基本配置）</li>
<li>webpack.dev.config.js（开发环境配置）</li>
<li>webpack.pro.config.js（生产环境配置）</li>
</ol>
<p>webpack 配置<a class="link"   href="https://www.webpackjs.com/guides/getting-started/#using-a-configuration" >官网参考 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">// target: &#x27;node&#x27;, // 如果需要打包后运行在nodejs环境下，需要设置此值</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(), <span class="comment">// 先删除打包目标目录再打包,</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./public/index.html&#x27;</span> <span class="comment">// 配置模板index.html文件</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">patterns</span>: [</span><br><span class="line">                &#123; <span class="attr">from</span>: <span class="string">&quot;./public/CNAME&quot;</span> &#125;, <span class="comment">// 把文件（CNAME等）移动到打包目录</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(baseConfig, &#123;</span><br><span class="line">    <span class="comment">// 开发模式配置</span></span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">static</span>: &#123;</span><br><span class="line">            <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>) <span class="comment">// 开发服务器根目录</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">8888</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.pro.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(baseConfig, &#123;</span><br><span class="line">    <span class="comment">// 生产模式配置</span></span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;scripts/bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>

<h2 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h2><p>最后为了方便，我们把启动 webpack 的命令行脚本添加到 npm 项目的 package.json 中</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server --config ./webpack.dev.config.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config ./webpack.pro.config.js&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>最后就可以快乐地使用项目了。<br><em>文章实时更新中…</em></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>使用自签证书开启本地https服务</title>
    <url>/2023/05/09/%E4%BD%BF%E7%94%A8%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E5%BC%80%E5%90%AF%E6%9C%AC%E5%9C%B0https%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<p>记录一下如何在本地搭建https服务</p>
<span id="more"></span>

<h1 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h1><p><em>以下操作在Ubuntu环境下进行</em></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成密钥</span></span><br><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成证书请求文件</span></span><br><span class="line"><span class="comment"># Common Name 是自己的域名，测试的话可以随便写一个</span></span><br><span class="line">openssl req -new -key server.key -out server.csr</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成证书</span></span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> server. csr -signkey server.key -out server.crt</span><br></pre></td></tr></table></figure></div>

<p>然后开启nodejs服务</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">9999</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = https.<span class="title function_">createServer</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./server.key&#x27;</span>),</span><br><span class="line">    <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./server.crt&#x27;</span>),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">listen</span>(<span class="number">9999</span>);</span><br></pre></td></tr></table></figure></div>


<p>参考<a class="link"   href="https://blog.csdn.net/xgangzai/article/details/112300962" >https://blog.csdn.net/xgangzai/article/details/112300962 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Node.js</tag>
      </tags>
  </entry>
  <entry>
    <title>在租房环境下搭建DDNS服务器</title>
    <url>/2023/05/09/%E5%9C%A8%E7%A7%9F%E6%88%BF%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%90%AD%E5%BB%BADDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<p>事情是这样的，自从我毕业以后，就一直想要搭建个自己的服务器，但是自己很穷且云服务器太贵，而且不能体验到自己动手搭建的乐趣，所以才有了这篇文章</p>
<span id="more"></span>
<p><em><strong>开始前要说一下，如果没有光猫的超级管理员权限，是不能配置一级路由光猫的，所以最好打电话询问网络服务商要超管账号和密码</strong></em></p>
<h1 id="路由器篇"><a href="#路由器篇" class="headerlink" title="路由器篇"></a>路由器篇</h1><p>我租的房子路由拓扑结构如下：</p>
<ol>
<li>一台光猫（顶级路由）</li>
<li>我自己的路由器（二级路由）</li>
</ol>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>进入光猫配置界面，将自己的二级路由设置为静态IP，并且设置为DMZ主机，这样就可以将大部分配置权限转移到二级路由去了</p>
<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>在二级路由配置界面设置DDNS，这里就不细说了，因为二级路由已经是DMZ主机了，所以可以直接设置二级路由DDNS</p>
<h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h2><p>重启光猫的防火墙，这一步是个坑，重启一下最好，不然容易遇到问题。（我用的是中兴f450g光猫）</p>
<h2 id="第三步-1"><a href="#第三步-1" class="headerlink" title="第三步"></a>第三步</h2><p>在二级路由里面配置虚拟主机，这样就可以在外网使用DDNS域名配合二级路由暴露的端口调用本地服务了，但是注意这里有个坑，外部端口需要设置的大一些，在60000 - 65535最好，不然容易遇到问题</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>在内网访问DDNS的域名似乎不能成功，暂时不能解决</p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>DDNS</tag>
      </tags>
  </entry>
  <entry>
    <title>用CSS做一个椭圆轨道小球运动动画</title>
    <url>/2023/05/12/%E7%94%A8CSS%E5%81%9A%E4%B8%80%E4%B8%AA%E6%A4%AD%E5%9C%86%E8%BD%A8%E9%81%93%E5%B0%8F%E7%90%83%E8%BF%90%E5%8A%A8%E5%8A%A8%E7%94%BB/</url>
    <content><![CDATA[<p>个人CSS技能查漏补缺系列  </p>
<p>关键在于使用关键帧(keyframs)时让两个动画重叠，并让其中一个动画延迟  </p>
<p>直接上代码  </p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attr">--ballCount</span>: <span class="number">2</span>; <span class="comment">/* 小球数量 */</span></span></span><br><span class="line"><span class="language-css">            <span class="attr">--ballAnimTime</span>: <span class="number">1s</span>; <span class="comment">/* 动画单轮总时间 */</span></span></span><br><span class="line"><span class="language-css">            <span class="attr">--ballAnimDeley</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="number">4</span>); <span class="comment">/* 为了实现椭圆轨迹而计算的延迟时间，为单轮总时间除以4 */</span></span></span><br><span class="line"><span class="language-css">            <span class="attr">--ballUnitAnimTime</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="built_in">var</span>(--ballCount)); <span class="comment">/* 小球延迟，为单轮总时间除以小球数量 */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">60vw</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">30vw</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">resize</span>: auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper</span> &gt; <span class="selector-class">.ball</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">2vw</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">2vw</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: blue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* Y轴移动动画 */</span></span></span><br><span class="line"><span class="language-css">        <span class="keyword">@keyframes</span> moveY &#123;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">from</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">top</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="comment">/* X轴移动动画 */</span></span></span><br><span class="line"><span class="language-css">        <span class="keyword">@keyframes</span> moveX &#123;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">from</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">to</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">left</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper</span> &gt; <span class="selector-class">.ball1</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="comment">/* moveY需要比moveX延迟一段时间，才能显示出椭圆轨迹，这个时间为--ballAnimDeley*/</span></span></span><br><span class="line"><span class="language-css">            <span class="comment">/* animation: name duration timing-function delay iteration-count direction fill-mode; */</span></span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation</span>: </span></span><br><span class="line"><span class="language-css">            moveY <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="number">2</span>) <span class="built_in">cubic-bezier</span>(<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.6</span>) <span class="built_in">calc</span>(-<span class="number">1</span> * (<span class="built_in">var</span>(--ballAnimDeley) + <span class="number">0</span> * <span class="built_in">var</span>(--ballUnitAnimTime))) infinite alternate,</span></span><br><span class="line"><span class="language-css">            moveX <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="number">2</span>) <span class="built_in">cubic-bezier</span>(<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.6</span>) <span class="built_in">calc</span>(-<span class="number">1</span> * <span class="number">0</span> * <span class="built_in">var</span>(--ballUnitAnimTime)) infinite alternate;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#wrapper</span> &gt; <span class="selector-class">.ball2</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation</span>: </span></span><br><span class="line"><span class="language-css">            moveY <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="number">2</span>) <span class="built_in">cubic-bezier</span>(<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.6</span>) <span class="built_in">calc</span>(-<span class="number">1</span> * (<span class="built_in">var</span>(--ballAnimDeley) + <span class="number">1</span> * <span class="built_in">var</span>(--ballUnitAnimTime))) infinite alternate,</span></span><br><span class="line"><span class="language-css">            moveX <span class="built_in">calc</span>(<span class="built_in">var</span>(--ballAnimTime) / <span class="number">2</span>) <span class="built_in">cubic-bezier</span>(<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.3</span>, <span class="number">0.6</span>) <span class="built_in">calc</span>(-<span class="number">1</span> * <span class="number">1</span> * <span class="built_in">var</span>(--ballUnitAnimTime)) infinite alternate;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>线框右下角可以拖拽改变大小<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ball ball1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ball ball2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- more --&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>参考<a class="link"   href="https://www.cnblogs.com/lin494910940/p/14051631.html" >https://www.cnblogs.com/lin494910940/p/14051631.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<hr>
<hr>
<h1 id="用Javascript实现"><a href="#用Javascript实现" class="headerlink" title="用Javascript实现"></a>用Javascript实现</h1><p>后来发现css实现的效果不好，小球运动到盒子四边时会有明显的碰撞感，所以这里用js实现一下</p>
<p>目录结构</p>
<ul>
<li>EllipsisGenerator.js</li>
<li>index.html</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// EllipsisGenerator.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 椭圆轨道坐标生成器类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EllipsisGenerator</span> &#123;</span><br><span class="line">    x;</span><br><span class="line">    y;</span><br><span class="line">    a;</span><br><span class="line">    b;</span><br><span class="line">    angle;</span><br><span class="line">    angleStep;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造一个椭圆轨道</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; x 圆心x坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; y 圆心y坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; a x轴半径长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; b y轴半径长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; angle 起始角度 单位deg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; angleStep 角度自增值 单位deg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x, y, a, b, angle = <span class="number">0</span>, angleStep = <span class="number">1</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = b;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">angle</span> = angle;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">angleStep</span> = angleStep;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * *generate方法返回一个迭代器，每次调用迭代器的next方法就会使角度(this.angle)自增(this.angleStep)，</span></span><br><span class="line"><span class="comment">     * 然后返回角度射线与椭圆轨道的交点坐标(x,y)，即椭圆轨道坐标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    *<span class="title function_">generate</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> radians = <span class="variable language_">this</span>.<span class="property">angle</span> * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180</span></span><br><span class="line">                , tx = <span class="variable language_">this</span>.<span class="property">a</span> * <span class="title class_">Math</span>.<span class="title function_">cos</span>(radians)</span><br><span class="line">                , ty = <span class="variable language_">this</span>.<span class="property">b</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(radians);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">x</span> + tx,</span><br><span class="line">                <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">y</span> + ty</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">angle</span> &gt;= <span class="number">360</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">angle</span> = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">angle</span> += <span class="variable language_">this</span>.<span class="property">angleStep</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border: 1px solid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./EllipsisGenerator.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> bubbleCount = <span class="number">100</span>; <span class="comment">// 球球数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> bubbleRadius = <span class="number">10</span>; <span class="comment">// 球球半径</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> frameRate = <span class="number">40</span>; <span class="comment">// 渲染帧数；每秒40帧</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> bubbleColor = <span class="string">&#x27;yellowgreen&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> bubbles = [];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">class</span> <span class="title class_">Bubble</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                x;</span></span><br><span class="line"><span class="language-javascript">                y;</span></span><br><span class="line"><span class="language-javascript">                r;</span></span><br><span class="line"><span class="language-javascript">                alpha;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">constructor</span>(<span class="params">x = <span class="number">0</span>, y = <span class="number">0</span>, r = <span class="number">1</span>, alpha = <span class="number">1</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">x</span> = x;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">y</span> = y;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">r</span> = r;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">alpha</span> = alpha;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> $star = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> width = <span class="number">600</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> height = <span class="number">400</span>;</span></span><br><span class="line"><span class="language-javascript">            $star.<span class="property">width</span> = width;</span></span><br><span class="line"><span class="language-javascript">            $star.<span class="property">height</span> = height;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> elliptic = <span class="keyword">new</span> <span class="title class_">EllipsisGenerator</span>(</span></span><br><span class="line"><span class="language-javascript">                width / <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                height / <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                width / <span class="number">2</span> - bubbleRadius,</span></span><br><span class="line"><span class="language-javascript">                height / <span class="number">2</span> - bubbleRadius,</span></span><br><span class="line"><span class="language-javascript">                <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">                -<span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">            );</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> generate = elliptic.<span class="title function_">generate</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> ctx = $star.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">                ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> &#123; x, y &#125; = generate.<span class="title function_">next</span>().<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (bubbles.<span class="property">length</span> &gt;= bubbleCount) &#123;</span></span><br><span class="line"><span class="language-javascript">                    bubbles.<span class="title function_">shift</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> bubble = <span class="keyword">new</span> <span class="title class_">Bubble</span>(x, y, <span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript">                bubbles.<span class="title function_">push</span>(bubble);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//渲染bubble数组</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bubbles.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> bubble = bubbles[i];</span></span><br><span class="line"><span class="language-javascript">                    bubble.<span class="property">alpha</span> = (i + <span class="number">1</span>) * (<span class="number">1</span> / bubbleCount);</span></span><br><span class="line"><span class="language-javascript">                    bubble.<span class="property">r</span> = bubble.<span class="property">r</span> * (i + <span class="number">1</span>) * (<span class="number">1</span> / bubbleCount);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="title function_">save</span>();</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="title function_">beginPath</span>();</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="property">globalAlpha</span> = bubble.<span class="property">alpha</span> * <span class="number">0.5</span>;</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="property">fillStyle</span> = bubbleColor;</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="title function_">arc</span>(</span></span><br><span class="line"><span class="language-javascript">                        bubble.<span class="property">x</span>,</span></span><br><span class="line"><span class="language-javascript">                        bubble.<span class="property">y</span>,</span></span><br><span class="line"><span class="language-javascript">                        bubble.<span class="property">r</span> * <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                    );</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="title function_">fill</span>();</span></span><br><span class="line"><span class="language-javascript">                    ctx.<span class="title function_">restore</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">requestAnimationFrame</span>(run);</span></span><br><span class="line"><span class="language-javascript">                &#125;, <span class="number">1000</span> / frameRate);</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">run</span>();</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>特效</tag>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>总结一下安卓手机抓包流程</title>
    <url>/2023/05/27/%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E6%8A%93%E5%8C%85%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<p>因为想给移动端APP做自动签到的功能，所以给手机抓包是必经的课题。</p>
<hr>
<h1 id="简单说一下思路："><a href="#简单说一下思路：" class="headerlink" title="简单说一下思路："></a>简单说一下思路：</h1><p><strong>笔记本电脑开启热点，手机连接热点，然后在电脑上对热点网卡抓包，这样，就可以完全监控手机的网络流量</strong></p>
<h1 id="主要是用到以下工具："><a href="#主要是用到以下工具：" class="headerlink" title="主要是用到以下工具："></a>主要是用到以下工具：</h1><ul>
<li>笔记本电脑热点</li>
<li>Wireshark</li>
<li>安卓手机</li>
</ul>
<span id="more"></span>


<h1 id="笔记本电脑开启移动热点"><a href="#笔记本电脑开启移动热点" class="headerlink" title="笔记本电脑开启移动热点"></a>笔记本电脑开启移动热点</h1><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/QQ%E6%88%AA%E5%9B%BE20230527142117.png"
                     
                ></p>
<h1 id="手机连接热点"><a href="#手机连接热点" class="headerlink" title="手机连接热点"></a>手机连接热点</h1><p>注意啊，为了抓包的准确性，手机最好关闭流量功能，关闭双WIFI加速功能<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/1685169004870.jpg"
                     
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/1685169004846.jpg"
                     
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/1685169004818.jpg"
                     
                ></p>
<h1 id="Wireshark监听开启热点的网卡"><a href="#Wireshark监听开启热点的网卡" class="headerlink" title="Wireshark监听开启热点的网卡"></a>Wireshark监听开启热点的网卡</h1><p>手机连接笔记本电脑热点后可以看到自己的<strong>网关地址</strong>，根据这个<strong>网关地址</strong>可以在Wireshark确定要抓包的网卡<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/1685169004924.jpg"
                     
                ><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/1685169493008.jpg"
                     
                ><br>拿到网关地址后就可以去Wireshark筛选网卡了<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/QQ%E6%88%AA%E5%9B%BE20230527144113.png"
                     
                ><br>确定网卡后就可以愉快的抓包了！</p>
<h1 id="Wireshark常用过滤规则"><a href="#Wireshark常用过滤规则" class="headerlink" title="Wireshark常用过滤规则"></a>Wireshark常用过滤规则</h1><p>我常用的规则就是：<br>ip.src &#x3D;&#x3D; xxx.xxx.xxx.xxx and ip.dst &#x3D;&#x3D; xxx.xxx.xxx.xxx and http<br>意思是指定发送包的IP地址、包目的地ip地址并且指定只抓http协议的包</p>
<h1 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h1><p>Wireshark抓包出现 [truncated] 怎么办？<br> [truncated] 表示信息不全，如果想要看到完整的信息需要右键出现 [truncated] 的那条信息，<br>然后如图操作，就可以看到完整的包信息了<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/QQ%E6%88%AA%E5%9B%BE20230527145323.png"
                     
                ></p>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>抓包</tag>
        <tag>Wireshark</tag>
      </tags>
  </entry>
  <entry>
    <title>实现一个基本的WebSocket前后端数据交互功能</title>
    <url>/2023/03/07/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84WebSocket%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>后端使用 nodejs 开发，使用到了<a class="link"   href="https://www.npmjs.com/package/nodejs-websocket" >nodejs-websocket <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>库</p>
<p>前端使用了 H5 原生的 WebSocket 功能</p>
<hr>
<h2 id="直接上代码"><a href="#直接上代码" class="headerlink" title="直接上代码"></a>直接上代码</h2><span id="more"></span>

<h3 id="后端代码（backend-js）："><a href="#后端代码（backend-js）：" class="headerlink" title="后端代码（backend.js）："></a>后端代码（backend.js）：</h3><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="built_in">require</span>(<span class="string">&#x27;nodejs-websocket&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建websocket服务端，返回一个socket连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">port</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">host</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">port = <span class="number">6868</span>, host = <span class="string">&#x27;localhost&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> server = ws.<span class="title function_">createServer</span>(<span class="function">(<span class="params">connection</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;检测到新的连接&#x27;</span>);</span><br><span class="line">            <span class="title function_">resolve</span>(connection);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        server.<span class="title function_">listen</span>(port, host);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> socket = <span class="keyword">await</span> <span class="title function_">run</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务端主动发送信息</span></span><br><span class="line">    socket.<span class="title function_">sendText</span>(<span class="string">&#x27;服务端发出的信息&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务端接收信息</span></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;text&#x27;</span>, <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`服务端收到的信息：<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>();</span><br></pre></td></tr></table></figure></div>

<h3 id="前端代码（frontend-html）："><a href="#前端代码（frontend-html）：" class="headerlink" title="前端代码（frontend.html）："></a>前端代码（frontend.html）：</h3><div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">             * 创建websocket客户端，返回一个socket连接</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">             * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">url</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">             * <span class="doctag">@returns</span> &#123;<span class="type">Promise</span>&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">             */</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(url);</span></span><br><span class="line"><span class="language-javascript">                    socket.<span class="title function_">addEventListener</span>(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;创建连接成功&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="title function_">resolve</span>(socket);</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> socket = <span class="keyword">await</span> <span class="title function_">run</span>(<span class="string">&#x27;ws://localhost:6868&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 客户端主动发送信息</span></span></span><br><span class="line"><span class="language-javascript">                socket.<span class="title function_">send</span>(<span class="string">&#x27;客户端发出的信息&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 客户端接收信息</span></span></span><br><span class="line"><span class="language-javascript">                socket.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`客户端收到的信息：<span class="subst">$&#123;res.data&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">test</span>();</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>第一篇文章哦</title>
    <url>/2023/03/16/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%93%A6/</url>
    <content><![CDATA[<h2 id="别催"><a href="#别催" class="headerlink" title="别催!!"></a>别催!!</h2><h3 id="作者正在长脑子"><a href="#作者正在长脑子" class="headerlink" title="作者正在长脑子~"></a>作者正在长脑子~</h3><h4 id="别急。快了！快有内容了！"><a href="#别急。快了！快有内容了！" class="headerlink" title="别急。快了！快有内容了！"></a>别急。快了！快有内容了！</h4><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打点代码证明脑子快就长好了！&#x27;</span>);</span><br></pre></td></tr></table></figure></div>]]></content>
  </entry>
  <entry>
    <title>用css3实现一个星球节点旋转效果图</title>
    <url>/2023/02/05/%E7%94%A8css3%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%98%9F%E7%90%83%E8%8A%82%E7%82%B9%E6%97%8B%E8%BD%AC%E6%95%88%E6%9E%9C%E5%9B%BE/</url>
    <content><![CDATA[<h3 id="点击查看效果图"><a href="#点击查看效果图" class="headerlink" title="点击查看效果图"></a><a href="/mypage/%E7%94%A8css3%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%98%9F%E7%90%83%E8%8A%82%E7%82%B9%E6%97%8B%E8%BD%AC%E6%95%88%E6%9E%9C%E5%9B%BE/index.html">点击查看效果图</a></h3><hr>
<p><strong>本来看到这个需求我还在想自己造轮子，第一个方案就是用css3的transform实现，后来因为自己实在太弱了，做不出来，没办法，还是去找大佬的轮子~</strong><br><strong>等后面有机会了再试试能不能自己写出来~</strong></p>
<hr>
<p>这个效果使用了<a class="link"   href="https://github.com/NiklasKnaack/jquery-svg3dtagcloud-plugin" >jquery-svg3dtagcloud-plugin <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>插件<br>源码直接放在下面了，如果需要可以直接复制修改</p>
<span id="more"></span>

<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>用css3实现一个星球节点旋转效果图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;holder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 这里可以配合jquery使用，也可以不用jquery独立使用 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script src=&quot;../common/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./jquery.svg3dtagcloud.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置要显示的条目</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> entries = [</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;中国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;美国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;加拿大&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;日本&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;墨西哥&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;英国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;法国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;德国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;西班牙&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;古巴&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;利比亚&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;韩国&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123; <span class="attr">label</span>: <span class="string">&#x27;俄罗斯&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/mypage/用css3实现一个星球节点旋转效果图&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置参数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> settings = &#123;</span></span><br><span class="line"><span class="language-javascript">                entries,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">width</span>: <span class="number">480</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">height</span>: <span class="number">480</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">radius</span>: <span class="string">&#x27;65%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">radiusMin</span>: <span class="number">75</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bgDraw</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bgColor</span>: <span class="string">&#x27;white&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">opacityOver</span>: <span class="number">1.00</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">opacityOut</span>: <span class="number">0.05</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">opacitySpeed</span>: <span class="number">6</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fov</span>: <span class="number">800</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">speed</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontFamily</span>: <span class="string">&#x27;Oswald, Arial, sans-serif&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontSize</span>: <span class="string">&#x27;15&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontColor</span>: <span class="string">&#x27;#333&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontWeight</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//bold</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontStyle</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//italic </span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontStretch</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//wider, narrower, ultra-condensed, extra-condensed, condensed, semi-condensed, semi-expanded, expanded, extra-expanded, ultra-expanded</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontToUpperCase</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontFamily</span>: <span class="string">&#x27;Oswald, Arial, sans-serif&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontSize</span>: <span class="string">&#x27;11&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontColor</span>: <span class="string">&#x27;#fff&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontWeight</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//bold</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontStyle</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//italic </span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontStretch</span>: <span class="string">&#x27;normal&#x27;</span>,<span class="comment">//wider, narrower, ultra-condensed, extra-condensed, condensed, semi-condensed, semi-expanded, expanded, extra-expanded, ultra-expanded</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipFontToUpperCase</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipTextAnchor</span>: <span class="string">&#x27;left&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipDiffX</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltipDiffY</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">animatingSpeed</span>: <span class="number">0.01</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">animatingRadiusLimit</span>: <span class="number">1.3</span></span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 这里可以配合jquery使用，也可以不用jquery独立使用</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// $( &#x27;#holder&#x27; ).svg3DTagCloud( settings );</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> svg3DTagCloud = <span class="keyword">new</span> <span class="title class_">SVG3DTagCloud</span>( <span class="variable language_">document</span>.<span class="title function_">getElementById</span>( <span class="string">&#x27;holder&#x27;</span>  ), settings );</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>特效</tag>
        <tag>Css</tag>
        <tag>面试题</tag>
        <tag>SVG</tag>
      </tags>
  </entry>
  <entry>
    <title>用CSS画一个正方形</title>
    <url>/2023/05/12/%E7%94%A8CSS%E7%94%BB%E4%B8%80%E4%B8%AA%E6%AD%A3%E6%96%B9%E5%BD%A2/</url>
    <content><![CDATA[<p>个人 CSS 技能查漏补缺系列</p>
<p>关键在于 padding-top 和 padding-bottom 使用百分比(%)单位时是基于元素的 width 来计算的。</p>
<p>直接上代码</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="keyword">@keyframes</span> show &#123;</span></span><br><span class="line"><span class="language-css">                <span class="number">0%</span> &#123;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">height</span>: <span class="number">240px</span>;</span></span><br><span class="line"><span class="language-css">                &#125;</span></span><br><span class="line"><span class="language-css">                <span class="number">25%</span> &#123;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                &#125;</span></span><br><span class="line"><span class="language-css">                <span class="number">50%</span> &#123;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">height</span>: <span class="number">240px</span>;</span></span><br><span class="line"><span class="language-css">                &#125;</span></span><br><span class="line"><span class="language-css">                <span class="number">75%</span> &#123;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                &#125;</span></span><br><span class="line"><span class="language-css">                <span class="number">100%</span> &#123;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                    <span class="attribute">height</span>: <span class="number">240px</span>;</span></span><br><span class="line"><span class="language-css">                &#125;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#wrapper</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">animation</span>: show <span class="number">5s</span> linear <span class="number">0s</span> infinite;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#wrapper</span> &gt; <span class="selector-id">#cube</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attr">--side</span>: <span class="number">80%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="built_in">var</span>(--side);</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--side) / <span class="number">2</span>) <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: blue;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>不管线框容器宽高怎么变，蓝色区块的宽高始终相等<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;cube&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>Css</tag>
      </tags>
  </entry>
  <entry>
    <title>通过WebRTC实现局域网p2p文件传输功能</title>
    <url>/2023/05/16/%E9%80%9A%E8%BF%87WebRTC%E5%AE%9E%E7%8E%B0%E5%B1%80%E5%9F%9F%E7%BD%91p2p%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>起初我是想实现一个不论在内网还是公网环境下都能建立p2p连接传输文件的功能，后来经过学习发现，内网环境实现起来很简单，但是公网就很麻烦了，要用到STUN和TURN，并且不符合我“只能通过p2p传输文件，不能经过中转服务器”的理念，所以这个项目只实现了<strong>局域网</strong>这部分的功能</p>
<h1 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h1><ul>
<li>因为信令服务器没有部署ssl证书，所以当前端页面部署到https协议的服务器里时，无法访问信令服务器</li>
</ul>
<h1 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h1><ul>
<li>p2p：对等连接。</li>
<li>信令服务器：帮助p2p双方交换进行WebRTC连接所必须的信息，一般用WebSocket实现。</li>
<li>STUN：帮助p2p双方获取到对方的IP地址和端口号，<em>（仅公网和多重内网环境需要）</em>。</li>
<li>TURN：数据中转服务，当p2p连接失败时，会使用TURN服务中转数据，<em>（仅公网和多重内网环境需要）</em>。</li>
</ul>
<span id="more"></span>

<h1 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h1><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/webrtc_test.gif"
                     
                ></p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="信令服务器目录结构"><a href="#信令服务器目录结构" class="headerlink" title="信令服务器目录结构"></a>信令服务器目录结构</h2><ul>
<li>src<ul>
<li>server.js 主文件</li>
<li>Users.js 用户类</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ws = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Users</span> = <span class="built_in">require</span>(<span class="string">&#x27;./Users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">9999</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">middleware</span> = (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 允许跨域连接</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="comment">// &#x27;Content-Type&#x27;: &#x27;text/plain&#x27;,</span></span><br><span class="line">        <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>: <span class="string">&#x27;Content-Type&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>: <span class="string">&#x27;GET, POST, PUT, DELETE, OPTIONS&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server;</span><br><span class="line"><span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(<span class="string">&#x27;./ssl/server.crt&#x27;</span>)) &#123; <span class="comment">// 如果根目录有ssl证书则使用https</span></span><br><span class="line">    server = https.<span class="title function_">createServer</span>(&#123;</span><br><span class="line">        <span class="attr">key</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./ssl/server.key&#x27;</span>),</span><br><span class="line">        <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./ssl/server.crt&#x27;</span>),</span><br><span class="line">    &#125;, middleware)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    server = http.<span class="title function_">createServer</span>(middleware);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wsServer = <span class="keyword">new</span> ws.<span class="title class_">Server</span>(&#123;</span><br><span class="line">    server</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users = <span class="keyword">new</span> <span class="title class_">Users</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMsghandler</span> = socket =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;socket创建成功&#x27;</span>);</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> obj;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg.<span class="title function_">toString</span>())</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">        <span class="keyword">let</span> &#123; type, data &#125; = obj;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;login&#x27;</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">let</span> flag = users.<span class="title function_">addUser</span>(socket);</span><br><span class="line">                    socket.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;login_success&#x27;</span>,</span><br><span class="line">                        <span class="attr">data</span>: flag,</span><br><span class="line">                    &#125;))</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前用户列表&#x27;</span>, users.<span class="title function_">getUserFlags</span>());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;send_offer&#x27;</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">let</span> userRemote = users.<span class="title function_">getUserByFlag</span>(data.<span class="property">flagRemote</span>);</span><br><span class="line">                    <span class="keyword">if</span> (userRemote === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        socket.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;remote_disconnected&#x27;</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        userRemote.<span class="property">socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;receive_offer&#x27;</span>,</span><br><span class="line">                            data</span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;send_answer&#x27;</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">let</span> userRemote = users.<span class="title function_">getUserByFlag</span>(data.<span class="property">flagRemote</span>);</span><br><span class="line">                    <span class="keyword">if</span> (userRemote === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        socket.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;remote_disconnected&#x27;</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        userRemote.<span class="property">socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;receive_answer&#x27;</span>,</span><br><span class="line">                            data</span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;send_ice&#x27;</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">let</span> userRemote = users.<span class="title function_">getUserByFlag</span>(data.<span class="property">flagRemote</span>);</span><br><span class="line">                    <span class="keyword">if</span> (userRemote === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        socket.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;remote_disconnected&#x27;</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        userRemote.<span class="property">socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;receive_ice&#x27;</span>,</span><br><span class="line">                            data</span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端与服务端建立连接</span></span><br><span class="line">wsServer.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, onMsghandler);</span><br><span class="line">server.<span class="title function_">listen</span>(port);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`---listen on <span class="subst">$&#123;port&#125;</span>---`</span>);</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Users.js</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Users</span> &#123;</span><br><span class="line">    #list;</span><br><span class="line">    #timeoutLimit; <span class="comment">// 自动断开连接时间</span></span><br><span class="line">    #userLimit; <span class="comment">// 最大人数</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#list = <span class="keyword">new</span> <span class="title class_">Map</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#timeoutLimit = <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 保证足够时间交换进行WebRTC需要的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.#userLimit = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getUserFlags</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>.#list.<span class="title function_">keys</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getUserByFlag</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#list.<span class="title function_">get</span>(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addUser</span>(<span class="params">socket</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果用户超过限制，则删除第一个用户</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.#list.<span class="property">size</span> &gt;= <span class="variable language_">this</span>.#userLimit) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">deleteUser</span>(</span><br><span class="line">                <span class="variable language_">this</span>.#list.<span class="title function_">keys</span>().<span class="title function_">next</span>().<span class="property">value</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建用户id</span></span><br><span class="line">        <span class="keyword">let</span> flag = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>().<span class="title function_">toString</span>().<span class="title function_">substring</span>(<span class="number">8</span>).<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        flag.<span class="title function_">splice</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">        flag = flag.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定时删除用户</span></span><br><span class="line">        <span class="keyword">let</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">deleteUser</span>(flag);</span><br><span class="line">        &#125;, <span class="variable language_">this</span>.#timeoutLimit)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.#list.<span class="title function_">set</span>(flag, &#123;</span><br><span class="line">            timer,</span><br><span class="line">            socket</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">deleteUser</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> user = <span class="variable language_">this</span>.#list.<span class="title function_">get</span>(flag);</span><br><span class="line">        <span class="comment">// 通知用户登录超时</span></span><br><span class="line">        user.<span class="property">socket</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;login_timeout&#x27;</span></span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="comment">// 断开当前用户socket连接</span></span><br><span class="line">        user.<span class="property">socket</span>.<span class="title function_">close</span>();</span><br><span class="line">        <span class="comment">// 请除定时器</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(user.<span class="property">timer</span>);</span><br><span class="line">        <span class="comment">// 删除用户</span></span><br><span class="line">        <span class="variable language_">this</span>.#list.<span class="title function_">delete</span>(flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Users</span>;</span><br></pre></td></tr></table></figure></div>

<h2 id="前端页面目录结构"><a href="#前端页面目录结构" class="headerlink" title="前端页面目录结构"></a>前端页面目录结构</h2><ul>
<li>public<ul>
<li>index.html</li>
</ul>
</li>
<li>src<ul>
<li>index.js 主文件</li>
<li>FileTransfer.js 文件传输类（核心类）</li>
<li>utils.js 工具</li>
</ul>
</li>
</ul>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件传输<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#flag</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-class">.wsdisconnected</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: gray;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-class">.wsconnecting</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-class">.wsconnected</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-class">.pcconnecting</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#state</span> &gt; <span class="selector-class">.pcconnected</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#log</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">max-height</span>: <span class="number">10vh</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#userArea</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileArea</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileAreaInner</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileAreaInner</span> &gt; <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">90px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileAreaInner</span> &gt; <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="built_in">calc</span>((<span class="number">100%</span> - <span class="number">90px</span> - <span class="number">20px</span>) / <span class="number">2</span>);</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">overflow-x</span>: hidden;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileAreaInner</span> &gt; <span class="selector-class">.sendArea</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border-right</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#fileAreaInner</span> &gt; <span class="selector-class">.receiveArea</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border-left</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.fileList</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">list-style-type</span>: decimal;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.fileList</span> &gt; <span class="selector-class">.percent</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">22px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>: <span class="number">8px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.fileList</span> &gt; <span class="selector-class">.percent</span> &gt; <span class="selector-class">.bar</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">z-index</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">0%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: gray;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-size</span>: inherit;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.fileList</span> &gt; <span class="selector-class">.percent</span> &gt; <span class="selector-class">.text</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">max-width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">white-space</span>: nowrap;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">text-overflow</span>: ellipsis;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">pointer-events</span>: none;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-size</span>: inherit;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;state&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;wsdisconnected&quot;</span>&gt;</span>WebSocket未连接<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;wsconnecting&quot;</span>&gt;</span>WebSocket连接中...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;wsconnected&quot;</span>&gt;</span>WebSocket连接成功<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pcconnecting&quot;</span>&gt;</span>WebRTC连接中...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pcconnected&quot;</span>&gt;</span>WebRTC连接成功<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- log --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>日志<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;userArea&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前页面ID：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">readonly</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>输入对方页面ID：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;flagRemote&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;xx-xxx&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;flagRemoteBtn&quot;</span>&gt;</span></span><br><span class="line">                    确认</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;fileArea&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;fileAreaInner&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sendArea&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;uploadFile&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>发送列表：<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;sendList&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fileList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;abort&quot;</span>&gt;</span>终止传输<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;receiveArea&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>接收列表：<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;receiveList&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fileList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; haveWebSocket, haveWebRTC, $, gen, initDom, changeState, log &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FileTransfer</span> <span class="keyword">from</span> <span class="string">&quot;./FileTransfer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $state = $(<span class="string">&#x27;state&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $userArea = $(<span class="string">&#x27;userArea&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $flag = $(<span class="string">&#x27;flag&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $flagRemote = $(<span class="string">&#x27;flagRemote&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $flagRemoteBtn = $(<span class="string">&#x27;flagRemoteBtn&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $logDom = $(<span class="string">&#x27;log&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $fileArea = $(<span class="string">&#x27;fileArea&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $uploadFile = $(<span class="string">&#x27;uploadFile&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $sendList = $(<span class="string">&#x27;sendList&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $receiveList = $(<span class="string">&#x27;receiveList&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> $abort = $(<span class="string">&#x27;abort&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> wsServerUrl;</span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 测试环境信令服务器地址</span></span><br><span class="line">    wsServerUrl =<span class="string">&#x27;ws://localhost:9999&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 正式环境信令服务器地址</span></span><br><span class="line">    wsServerUrl =<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> $sendLi, $receiveLi;</span><br><span class="line"></span><br><span class="line"><span class="title function_">initDom</span>();</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">haveWebSocket</span>()) &#123;</span><br><span class="line">        <span class="title function_">myAlert</span>(<span class="string">&#x27;当前浏览器不支持WebSocket&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">haveWebRTC</span>()) &#123;</span><br><span class="line">        <span class="title function_">myAlert</span>(<span class="string">&#x27;当前浏览器不支持WebRTC&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ft = <span class="keyword">new</span> <span class="title class_">FileTransfer</span>(wsServerUrl);</span><br><span class="line">    ft.<span class="title function_">setLogDom</span>($logDom);</span><br><span class="line">    ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;statechange&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> state = ev.<span class="property">target</span>.<span class="title function_">getState</span>();</span><br><span class="line">        <span class="title function_">changeState</span>(state, $state);</span><br><span class="line">        <span class="title function_">log</span>(state, $logDom);</span><br><span class="line">        <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;wsdisconnected&#x27;</span>:</span><br><span class="line">                <span class="keyword">let</span> err = ft.<span class="title function_">getError</span>();</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(err.<span class="property">message</span>, $logDom);</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                $flag.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                $flagRemote.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                $userArea.<span class="title function_">hide</span>();</span><br><span class="line">                $fileArea.<span class="title function_">hide</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;wsconnected&#x27;</span>:</span><br><span class="line">                <span class="keyword">let</span> flag = ft.<span class="title function_">getFlag</span>();</span><br><span class="line">                $flag.<span class="property">value</span> = flag;</span><br><span class="line">                $userArea.<span class="title function_">show</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcconnecting&#x27;</span>:</span><br><span class="line">                $userArea.<span class="title function_">show</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;pcconnected&#x27;</span>:</span><br><span class="line">                $userArea.<span class="title function_">show</span>();</span><br><span class="line">                $fileArea.<span class="title function_">show</span>();</span><br><span class="line">                <span class="title function_">onRTCConnected</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    $abort.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;确认终止传输，该操作不可逆&#x27;</span>)) &#123;</span><br><span class="line">            ft.<span class="property">abort</span>.<span class="title function_">call</span>(ft);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    $flagRemoteBtn.<span class="property">onclick</span> = onFlagRemoteBtnClick;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onFlagRemoteBtnClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> flagRemote = $flagRemote.<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">if</span>(flagRemote === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;对方id不能为空&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flagRemote === ft.<span class="title function_">getFlag</span>()) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;不能输入自己的id&#x27;</span>);;</span><br><span class="line">            $flagRemote.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="regexp">/^\d&#123;2&#125;\-\d&#123;3&#125;$/</span>.<span class="title function_">test</span>(flagRemote)) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;对方id格式不正确，请输入 xx-xxx 格式&#x27;</span>);</span><br><span class="line">            $flagRemote.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ft.<span class="title function_">setFlagRemote</span>(flagRemote);</span><br><span class="line">            ft.<span class="title function_">connect</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onRTCConnected</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $uploadFile.<span class="property">onchange</span> = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> file = ev.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 开始发送文件</span></span><br><span class="line">            ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;sendfileinfo&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">                $uploadFile.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// 文件基本信息</span></span><br><span class="line">                <span class="keyword">let</span> fileInfo = ev.<span class="property">target</span>.<span class="title function_">getFileInfo</span>();</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;开始发送文件&#x27;</span>, $logDom);</span><br><span class="line">                <span class="title function_">log</span>(fileInfo, $logDom);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">from</span>($sendList.<span class="property">children</span>).<span class="title function_">find</span>($a =&gt; <span class="keyword">new</span> <span class="title class_">RegExp</span>(fileInfo.<span class="property">name</span>).<span class="title function_">test</span>($a.<span class="property">innerText</span>))) &#123;</span><br><span class="line">                    $sendLi = <span class="title function_">gen</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">                    $sendLi.<span class="property">innerText</span> = <span class="string">`<span class="subst">$&#123;fileInfo.name&#125;</span>(0%)`</span>;</span><br><span class="line">                    $sendList.<span class="title function_">appendChild</span>($sendLi);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 正在发送文件</span></span><br><span class="line">            ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;sending&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> sendPercent = ev.<span class="property">target</span>.<span class="title function_">getSendPercent</span>();</span><br><span class="line">                $sendLi.<span class="property">innerText</span> = $sendLi.<span class="property">innerText</span>.<span class="title function_">replace</span>(<span class="regexp">/\(\d&#123;1,3&#125;(\.\d&#123;1,2&#125;)?\%\)$/</span>, <span class="string">`(<span class="subst">$&#123;sendPercent&#125;</span>%)`</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 发送文件完毕</span></span><br><span class="line">            ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;sended&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;发送文件完毕&#x27;</span>);</span><br><span class="line">                $uploadFile.<span class="property">disabled</span> = <span class="literal">false</span>;</span><br><span class="line">                $uploadFile.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            ft.<span class="title function_">sendFile</span>(file);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始接收文件</span></span><br><span class="line">        ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;receivefileinfo&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            $uploadFile.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 文件基本信息</span></span><br><span class="line">            <span class="keyword">let</span> fileInfo = ev.<span class="property">target</span>.<span class="title function_">getFileInfo</span>();</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;开始接收文件&#x27;</span>, $logDom);</span><br><span class="line">            <span class="title function_">log</span>(fileInfo, $logDom);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">from</span>($receiveList.<span class="property">children</span>).<span class="title function_">find</span>($a =&gt; <span class="keyword">new</span> <span class="title class_">RegExp</span>(fileInfo.<span class="property">name</span>).<span class="title function_">test</span>($a.<span class="property">innerText</span>))) &#123;</span><br><span class="line">                $receiveLi = <span class="title function_">gen</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">                <span class="keyword">let</span> $a = <span class="title function_">gen</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                $a.<span class="property">innerText</span> = <span class="string">`<span class="subst">$&#123;fileInfo.name&#125;</span>(0%)`</span>;</span><br><span class="line">                $receiveLi.<span class="title function_">appendChild</span>($a);</span><br><span class="line">                $receiveList.<span class="title function_">appendChild</span>($receiveLi);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 正在接收文件</span></span><br><span class="line">        ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;receiving&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> receivePercent = ev.<span class="property">target</span>.<span class="title function_">getReceivePercent</span>();</span><br><span class="line">            <span class="keyword">let</span> $a = $receiveLi.<span class="property">children</span>[<span class="number">0</span>];</span><br><span class="line">            $a.<span class="property">innerText</span> = $a.<span class="property">innerText</span>.<span class="title function_">replace</span>(<span class="regexp">/\(\d&#123;1,3&#125;(\.\d&#123;1,2&#125;)?\%\)$/</span>, <span class="string">`(<span class="subst">$&#123;receivePercent&#125;</span>%)`</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 接收文件完毕</span></span><br><span class="line">        ft.<span class="title function_">addEventListener</span>(<span class="string">&#x27;received&#x27;</span>, <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            $uploadFile.<span class="property">disabled</span> = <span class="literal">false</span>;</span><br><span class="line">            $uploadFile.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">let</span> file = ev.<span class="property">target</span>.<span class="title function_">getFile</span>();</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;接收文件完毕&#x27;</span>, $logDom);</span><br><span class="line">            <span class="keyword">let</span> $a = $receiveLi.<span class="property">children</span>[<span class="number">0</span>];</span><br><span class="line">            $a.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(file);</span><br><span class="line">            $a.<span class="property">download</span> = $a.<span class="property">innerText</span>.<span class="title function_">replace</span>(<span class="regexp">/\(\d&#123;1,3&#125;(\.\d&#123;1,2&#125;)?\%\)$/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// FileTransfer.js</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; log &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileTransfer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">EventTarget</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接</span></span><br><span class="line">    #wsServerUrl;</span><br><span class="line">    #ws;</span><br><span class="line">    #pc;</span><br><span class="line">    #dc;</span><br><span class="line">    #dcRemote;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 中止标记</span></span><br><span class="line">    #abortFlag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态</span></span><br><span class="line">    #state;</span><br><span class="line">    #rtcSuccess = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志</span></span><br><span class="line">    #logDom;</span><br><span class="line">    #err;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对象页面标记</span></span><br><span class="line">    #flag;</span><br><span class="line">    #flagRemote;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送文件</span></span><br><span class="line">    #sendFileInterval = <span class="number">0</span>; <span class="comment">// 发送chunk之间的间隔时间，这里单位是毫秒。貌似只要异步就能避免send queue full，但还是给了他一个间隔时间</span></span><br><span class="line">    #sendFileChunkSize = <span class="number">4</span> * <span class="number">1024</span> <span class="comment">// 每次发送的chunk大小，单位为BYTE</span></span><br><span class="line">    #sendFileOffset;</span><br><span class="line">    #sendPercent = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件</span></span><br><span class="line">    #fileInfo;</span><br><span class="line">    #file;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接收文件</span></span><br><span class="line">    #receiveBuffer;</span><br><span class="line">    #receiveFileSize;</span><br><span class="line">    #receiveFileTotalSize;</span><br><span class="line">    #receivePercent = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个类封装了建立WebRTC连接的详细过程</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; wsServerUrl WebSockets服务器地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">wsServerUrl</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.#wsServerUrl = wsServerUrl;</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsdisconnected&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">initFileInfo</span>();</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">initWebSocket</span>();</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">initWebRTC</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #<span class="title function_">initWebSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="variable language_">this</span>.#wsServerUrl);</span><br><span class="line">        <span class="variable language_">this</span>.#ws.<span class="property">onopen</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;建立WebSocket连接成功&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">            <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsconnecting&#x27;</span>);</span><br><span class="line">            <span class="comment">// 登录</span></span><br><span class="line">            <span class="variable language_">this</span>.#ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;login&#x27;</span> &#125;));</span><br><span class="line">            <span class="variable language_">this</span>.#ws.<span class="property">onmessage</span> = <span class="function"><span class="params">msg</span> =&gt;</span> <span class="variable language_">this</span>.#wsMsgHandler.<span class="title function_">call</span>(<span class="variable language_">this</span>, msg)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.#ws.<span class="property">onerror</span> = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsdisconnected&#x27;</span>);</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;建立WebSocket连接失败&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err), <span class="variable language_">this</span>.#logDom, <span class="number">2</span>);</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;建立WebSocket连接失败&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Socket msg事件处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; msg </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">wsMsgHandler</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(err) &#123; &#125;</span><br><span class="line">        <span class="keyword">let</span> &#123; type, data &#125; = obj;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;type：&#x27;</span> + type, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;login_success&#x27;</span>:</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;登录成功&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="variable language_">this</span>.#flag = data;</span><br><span class="line">                <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsconnected&#x27;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;login_timeout&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable language_">this</span>.#rtcSuccess) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.#flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsdisconnected&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;remote_disconnected&#x27;</span>:</span><br><span class="line">                <span class="variable language_">this</span>.#flagRemote = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;wsdisconnected&#x27;</span>);</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&#x27;对方已掉线，请对方刷新网页&#x27;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;receive_offer&#x27;</span>:</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;接收Offer&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="variable language_">this</span>.#flagRemote = data.<span class="property">flag</span>;</span><br><span class="line">                <span class="variable language_">this</span>.#<span class="title function_">createAnswer</span>(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;receive_answer&#x27;</span>:</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;接收Answer&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="variable language_">this</span>.#<span class="title function_">receiveAnswer</span>(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;receive_ice&#x27;</span>:</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;接收Ice&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="variable language_">this</span>.#<span class="title function_">receiveIce</span>(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建Offer并发送</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> #<span class="title function_">createOffer</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;pcconnecting&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> offer = <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">createOffer</span>();</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">createIce</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;发送Offer&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">        <span class="variable language_">this</span>.#ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;send_offer&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">flag</span>: <span class="variable language_">this</span>.#flag,</span><br><span class="line">                <span class="attr">flagRemote</span>: <span class="variable language_">this</span>.#flagRemote,</span><br><span class="line">                <span class="attr">sdp</span>: offer,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建Answer并发送</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> #<span class="title function_">createAnswer</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> offer = data.<span class="property">sdp</span>;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">setRemoteDescription</span>(offer);</span><br><span class="line">        <span class="keyword">let</span> answer = <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">createAnswer</span>();</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">setLocalDescription</span>(answer);</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">createIce</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;发送Answer&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">        <span class="variable language_">this</span>.#ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;send_answer&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">flag</span>: <span class="variable language_">this</span>.#flag,</span><br><span class="line">                <span class="attr">flagRemote</span>: <span class="variable language_">this</span>.#flagRemote,</span><br><span class="line">                <span class="attr">sdp</span>: answer,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成Offer/Answer交换</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> #<span class="title function_">receiveAnswer</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> answer = data.<span class="property">sdp</span>;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.#pc.<span class="title function_">setRemoteDescription</span>(answer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建icecandidate并发送</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">createIce</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#pc.<span class="property">onicecandidate</span> = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ev.<span class="property">candidate</span>) &#123;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;发送Ice&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="variable language_">this</span>.#ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;send_ice&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: &#123;</span><br><span class="line">                        <span class="attr">flag</span>: <span class="variable language_">this</span>.#flag,</span><br><span class="line">                        <span class="attr">flagRemote</span>: <span class="variable language_">this</span>.#flagRemote,</span><br><span class="line">                        <span class="attr">ice</span>: ev.<span class="property">candidate</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收icecandidate并保存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; data </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">receiveIce</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; ice &#125; = data;</span><br><span class="line">        <span class="variable language_">this</span>.#pc.<span class="title function_">addIceCandidate</span>(ice);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #<span class="title function_">initWebRTC</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#pc = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(&#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            虽然只在内网环境实现p2p连接，但是可能出现多重内网的情况，所以还是添加一些STUN服务，</span></span><br><span class="line"><span class="comment">            由于这些STUN服务是第三方提供的，所以可能会出现不可用的情况，需要酌情更换</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="attr">iceServers</span>: [</span><br><span class="line">                &#123; <span class="attr">url</span>: <span class="string">&quot;stun:stun.l.google.com:19302&quot;</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">url</span>: <span class="string">&quot;stun:stun.services.mozilla.com&quot;</span> &#125;,</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">sdpSemantics</span>: <span class="string">&#x27;plan-b&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">initDataChannel</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #<span class="title function_">initDataChannel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 本地数据通道</span></span><br><span class="line">        <span class="variable language_">this</span>.#dc = <span class="variable language_">this</span>.#pc.<span class="title function_">createDataChannel</span>(<span class="string">&#x27;fileTransfer&#x27;</span>, &#123; <span class="attr">ordered</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">dcConntHandler</span>(<span class="variable language_">this</span>.#dc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 远端数据通道</span></span><br><span class="line">        <span class="variable language_">this</span>.#pc.<span class="property">ondatachannel</span> = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.#dcRemote = ev.<span class="property">channel</span>;</span><br><span class="line">            <span class="variable language_">this</span>.#<span class="title function_">dcConntHandler</span>(<span class="variable language_">this</span>.#dcRemote);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据通道连接事件处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">RTCDataChannel</span>&#125; dc </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">dcConntHandler</span>(<span class="params">dc</span>) &#123;</span><br><span class="line">        dc.<span class="property">onopen</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;建立WebRTC连接成功&#x27;</span>, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">            <span class="variable language_">this</span>.#rtcSuccess = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;pcconnected&#x27;</span>);</span><br><span class="line">            dc.<span class="property">onmessage</span> = <span class="function"><span class="params">msg</span> =&gt;</span> <span class="variable language_">this</span>.#dcMsgHandler.<span class="title function_">call</span>(<span class="variable language_">this</span>, msg);</span><br><span class="line">        &#125;</span><br><span class="line">        dc.<span class="property">onerror</span> = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.#<span class="title function_">setState</span>(<span class="string">&#x27;pcdisconnected&#x27;</span>);</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;建立WebRTC连接失败&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err), <span class="variable language_">this</span>.#logDom, <span class="number">2</span>);</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;建立WebRTC连接失败&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据通道msg事件处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; msg </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">dcMsgHandler</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.#abortFlag) &#123;</span><br><span class="line">            <span class="keyword">let</span> &#123; data &#125; = msg;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;收到文件基本信息&#x27;</span> + data, <span class="variable language_">this</span>.#logDom);</span><br><span class="line">                <span class="keyword">let</span> dataObj;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    dataObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">                <span class="variable language_">this</span>.#fileInfo = dataObj;</span><br><span class="line">                <span class="variable language_">this</span>.#receiveFileTotalSize = dataObj.<span class="property">size</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;receivefileinfo&#x27;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (data <span class="keyword">instanceof</span> <span class="title class_">ArrayBuffer</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.#receiveFileSize += data.<span class="property">byteLength</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data <span class="keyword">instanceof</span> <span class="title class_">Blob</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.#receiveFileSize += data.<span class="property">size</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">this</span>.#receivePercent = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="variable language_">this</span>.#receiveFileSize / <span class="variable language_">this</span>.#receiveFileTotalSize * <span class="number">1000</span>) / <span class="number">10</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;receiving&#x27;</span>));</span><br><span class="line">                    <span class="variable language_">this</span>.#receiveBuffer.<span class="title function_">push</span>(data);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.#receiveFileSize &gt;= <span class="variable language_">this</span>.#receiveFileTotalSize) &#123;</span><br><span class="line">                        <span class="keyword">let</span> file = <span class="keyword">new</span> <span class="title class_">Blob</span>(<span class="variable language_">this</span>.#receiveBuffer);</span><br><span class="line">                        <span class="variable language_">this</span>.#file = file;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;received&#x27;</span>));</span><br><span class="line">                        <span class="variable language_">this</span>.#<span class="title function_">initFileInfo</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="variable language_">this</span>.#sendFileInterval);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    #<span class="title function_">initFileInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#sendFileOffset = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#sendPercent = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#receiveBuffer = [];</span><br><span class="line">        <span class="variable language_">this</span>.#receiveFileSize = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#receiveFileTotalSize = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#receivePercent = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#fileInfo = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.#file = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #<span class="title function_">setState</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#state = state;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;statechange&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getSendPercent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#sendPercent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getReceivePercent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#receivePercent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getFileInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#fileInfo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getFlag</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getError</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.#err;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">setLogDom</span>(<span class="params">dom</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#logDom = dom;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setFlagRemote</span>(<span class="params">flag</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#flagRemote = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">connect</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#<span class="title function_">createOffer</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">sendFile</span>(<span class="params">file</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> fr = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先发送文件基本信息</span></span><br><span class="line">        <span class="variable language_">this</span>.#fileInfo = &#123;</span><br><span class="line">            <span class="attr">name</span>: file.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">size</span>: file.<span class="property">size</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.#dc.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.#fileInfo));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;sendfileinfo&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        fr.<span class="property">onload</span> = <span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.#dc.<span class="title function_">send</span>(ev.<span class="property">target</span>.<span class="property">result</span>);</span><br><span class="line">                <span class="variable language_">this</span>.#sendFileOffset += ev.<span class="property">target</span>.<span class="property">result</span>.<span class="property">byteLength</span>;</span><br><span class="line">                <span class="variable language_">this</span>.#sendPercent = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="variable language_">this</span>.#sendFileOffset / file.<span class="property">size</span> * <span class="number">1000</span>) / <span class="number">10</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;sending&#x27;</span>));</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.#sendFileOffset &lt; file.<span class="property">size</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="variable language_">this</span>.#abortFlag) &#123;</span><br><span class="line">                        <span class="title function_">readSlice</span>(<span class="variable language_">this</span>.#sendFileOffset);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;sended&#x27;</span>));</span><br><span class="line">                    <span class="variable language_">this</span>.#<span class="title function_">initFileInfo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="variable language_">this</span>.#sendFileInterval)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分段发送文件</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">readSlice</span> = offset =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> fileSlice = file.<span class="title function_">slice</span>(offset, offset + <span class="variable language_">this</span>.#sendFileChunkSize);</span><br><span class="line">            fr.<span class="title function_">readAsArrayBuffer</span>(fileSlice);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">readSlice</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">abort</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.#abortFlag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">FileTransfer</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">haveWebSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">WebSocket</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">haveWebRTC</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">RTCPeerConnection</span> = <span class="variable language_">window</span>.<span class="property">RTCPeerConnection</span></span><br><span class="line">        || <span class="variable language_">window</span>.<span class="property">webkitRTCPeerConnection</span></span><br><span class="line">        || <span class="variable language_">window</span>.<span class="property">mozRTCPeerConnection</span></span><br><span class="line">        || <span class="variable language_">window</span>.<span class="property">msRTCPeerConnection</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">RTCPeerConnection</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志记录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; msg </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">HTMLElement</span>&#125; dom </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; errLevel </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">msg, dom, errLevel = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> p = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    p.<span class="property">innerText</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(msg);</span><br><span class="line">    <span class="keyword">switch</span>(errLevel) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            p.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;gray&#x27;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(msg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            p.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;orange&#x27;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">warn</span>(msg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            p.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(msg);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dom) dom.<span class="title function_">prepend</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DOM ID选择器简化版</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; selector </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">HTMLElement</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(selector);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建DOM 简化版</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; tag </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">HTMLElement</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">gen</span>(<span class="params">tag</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 初始化DOM并为其添加常用方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initDom</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span>) &#123;</span><br><span class="line">       <span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;initial&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hide</span>) &#123;</span><br><span class="line">       <span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hide</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">isShow</span>) &#123;</span><br><span class="line">       <span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">isShow</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> !== <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasClass</span>) &#123;</span><br><span class="line">       <span class="title class_">Element</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasClass</span> = <span class="keyword">function</span> (<span class="params">className</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(className);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改连接状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; status </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">HTMLElement</span>&#125; <span class="variable">dom</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">changeState</span>(<span class="params">status, dom</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> $child <span class="keyword">of</span> dom.<span class="property">children</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($child.<span class="title function_">hasClass</span>(status)) &#123;</span><br><span class="line">            $child.<span class="title function_">show</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $child.<span class="title function_">hide</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>学习</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>WebRTC</tag>
      </tags>
  </entry>
</search>
